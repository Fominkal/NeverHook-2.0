local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local gui = Instance.new("ScreenGui")
gui.Name = "UltraCleanHUD"
gui.ResetOnSpawn = false
gui.Parent = playerGui

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 180, 0, 34)
frame.Position = UDim2.new(0.5, -90, 0.82, 0)
frame.BackgroundColor3 = Color3.fromRGB(13, 13, 17)
frame.BackgroundTransparency = 0.05
frame.BorderSizePixel = 0
frame.Parent = gui
frame.Active = true

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 14)
corner.Parent = frame

local line = Instance.new("Frame")
line.Size = UDim2.new(1, -40, 0, 2)
line.Position = UDim2.new(0, 20, 0.5, -1)
line.BackgroundColor3 = Color3.fromRGB(18, 55, 125)
line.BorderSizePixel = 0
line.Parent = frame

local lineCorner = Instance.new("UICorner")
lineCorner.CornerRadius = UDim.new(1, 0)
lineCorner.Parent = line

local clickZone = Instance.new("TextButton")
clickZone.Size = UDim2.new(1, 0, 1, 0)
clickZone.Position = UDim2.new(0, 0, 0, 0)
clickZone.BackgroundTransparency = 1
clickZone.Text = ""
clickZone.AutoButtonColor = false
clickZone.Parent = frame

local function getPCR()
	local pcr = CoreGui:FindFirstChild("PCR_1")
	if pcr and pcr:IsA("ScreenGui") then
		return pcr
	end
	return nil
end

local function togglePCR()
	local pcr = getPCR()
	if pcr then
		pcr.Enabled = not pcr.Enabled
	end
end

local function tapFeedback()
	local t1 = TweenService:Create(frame, TweenInfo.new(0.08, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
		BackgroundTransparency = 0.15
	})
	t1:Play()
	t1.Completed:Once(function()
		TweenService:Create(frame, TweenInfo.new(0.10), {BackgroundTransparency = 0.05}):Play()
	end)
end

local function clampFrame()
	local cam = workspace.CurrentCamera
	if not cam then return end

	local vp = cam.ViewportSize
	local abs = frame.AbsoluteSize

	local xScale, xOff = frame.Position.X.Scale, frame.Position.X.Offset
	local yScale, yOff = frame.Position.Y.Scale, frame.Position.Y.Offset

	local pad = 8

	local minXOff = pad - (xScale * vp.X)
	local minYOff = pad - (yScale * vp.Y)
	local maxXOff = (vp.X - abs.X - pad) - (xScale * vp.X)
	local maxYOff = (vp.Y - abs.Y - pad) - (yScale * vp.Y)

	xOff = math.clamp(xOff, minXOff, maxXOff)
	yOff = math.clamp(yOff, minYOff, maxYOff)

	frame.Position = UDim2.new(xScale, xOff, yScale, yOff)
end

local dragging = false
local dragStart, startPos
local startTime = 0
local movedEnough = false

local DRAG_DEADZONE = 10
local HOLD_TO_DRAG = 0.15

local function updateDrag(pos)
	local delta = pos - dragStart
	frame.Position = UDim2.new(
		startPos.X.Scale, startPos.X.Offset + delta.X,
		startPos.Y.Scale, startPos.Y.Offset + delta.Y
	)
	clampFrame()
end

clickZone.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1
	or input.UserInputType == Enum.UserInputType.Touch then
		dragStart = input.Position
		startPos = frame.Position
		startTime = os.clock()
		movedEnough = false
		dragging = false
	end
end)

clickZone.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement
	or input.UserInputType == Enum.UserInputType.Touch then
		local delta = (input.Position - dragStart)
		if delta.Magnitude > DRAG_DEADZONE then
			movedEnough = true
		end
		if movedEnough or (os.clock() - startTime) >= HOLD_TO_DRAG then
			dragging = true
			updateDrag(input.Position)
		end
	end
end)

clickZone.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1
	or input.UserInputType == Enum.UserInputType.Touch then
		if not dragging then
			tapFeedback()
			togglePCR()
		end
		dragging = false
	end
end)

local pcr = getPCR()
if pcr then
	pcr.Enabled = true
end

clampFrame()
